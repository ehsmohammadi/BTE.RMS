@model IEnumerable<BTE.RMS.Presentation.Web.ViewModel.Meeting.MeetingShowViewModel>
@{
    Layout = "~/Views/Shared/_Layout2.cshtml";
}

@section Styles{
    <link href="~/Content/Tooltipster/css/tooltipster.css" rel="stylesheet" />
    <link href="~/Content/StyleTimelineMeetings.css" rel="stylesheet" />
    <style>
        .week_days table tr td {
            font-family: yekan;
        }

        span.current_day {
            background: #DEBE22;
            border-radius: 100%;
            display: inline-block;
            width: 27px;
        }

        .fa-arrow-circle-right {
            cursor: pointer;
            font-size: 31px;
            position: absolute;
            right: 60px;
            margin-top: -14px;
            color: rgb(255, 61, 0);
        }

        .fa-arrow-circle-left {
            cursor: pointer;
            font-size: 31px;
            position: absolute;
            left: 15px;
            margin-top: -14px;
            color: rgb(255, 61, 0);
        }

        ::-webkit-scrollbar {
            width: 3px;
            height: 3px;
        }

        ::-webkit-scrollbar-button {
            width: 0px;
            height: 0px;
        }

        ::-webkit-scrollbar-thumb {
            background: #e1e1e1;
            border: 0px none #ffffff;
            border-radius: 50px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #ffffff;
            }

            ::-webkit-scrollbar-thumb:active {
                background: #000000;
            }

        ::-webkit-scrollbar-track {
            background: #666666;
            border: 0px none #ffffff;
            border-radius: 50px;
        }

            ::-webkit-scrollbar-track:hover {
                background: #666666;
            }

            ::-webkit-scrollbar-track:active {
                background: #333333;
            }

        ::-webkit-scrollbar-corner {
            background: transparent;
        }

        .meeting-date table {
            height: 80%;
        }

        .week_days {
            height: 85px !important;
            width: 100%;
            font-family: yekan;
            font-size: 15px;
            text-align: center;
        }

            .week_days table {
                width: 100%;
            }

            .week_days .week-days-name td, .week_days .week-days-number td {
                cursor: pointer;
                padding: 8px;
                font-size: 18px;
            }

        .meeting-date {
            padding-top: 15px;
            height: 115px;
            background-color: rgba(235, 235, 235, 0.68);
            border-bottom: 2px solid #c7c0c0;
        }

        .week_days .week-days-number {
            background-color: rgba(235, 235, 235, 0.68);
            border-top: 2px solid #c7c0c0;
            border-bottom: 2px solid;
        }
    </style>

}


<div class="row" style="margin-bottom:50px;">
    <div class="meeting-header">
        <img src="~/Content/Images/gharar_logo.png" class="gharar-logo" alt="gharar_logo" />

    </div>
    <div class="meeting-date">
        <table>
            <tr>
                <td style="width: 50%; border-left: solid 1px rgb(255, 61, 0);">
                    <div class="meeting-date-show" style=" font-size: 22px;">


                        <table class="" style="text-align: center;table-layout: fixed;font-size: 26px;">
                            <tbody>
                                <tr>
                                    <td style="">
                                        @ViewBag.PersianDay
                                    </td>
                                    <td style=" display: inline-block;  border-radius: 100%; padding: 5px; color: #ff3d00;  width: 52px; background: #FFFFFF;border: 2px solid #c7c0c0;">
                                        @ViewBag.PersianDayOfWeek
                                    </td>
                                    <td style="">
                                        @ViewBag.PersianMonth
                                    </td>
                                </tr>
                                <tr style="">
                                    <td colspan="3" style=" font-size: 23px; padding-top: 3px;">
                                        @ViewBag.PersianYear
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </td>
                <td>
                    <table style="text-align: center; table-layout: fixed;font-size: 24px;height: 45px;">
                        <tbody>
                            <tr>
                                <td style="border-right: 1px solid #b9b4b4; direction:ltr;">
                                    @ViewBag.Date
                                </td>
                                <td> @ViewBag.ArabicDate  </td>
                            </tr>

                        </tbody>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <a id="CreateMeeting" href="/Meetings/Create"><i class="fa fa-plus"></i></a>

    <div class="week_days">

        <table>
            <tr class="week-days-name">
                <td></td>
                <td>شنبه</td>
                <td>یک شنبه</td>
                <td>دو شنبه</td>
                <td>سه شنبه</td>
                <td>چهار شنبه</td>
                <td>پنج شنبه</td>
                <td>جمعه</td>
                <td></td>
            </tr>
            <tr class="week-days-number">

                <td><i class="fa fa-arrow-circle-right" aria-hidden="true"></i></td>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
                <td>5</td>
                <td>6</td>
                <td>7</td>
                <td><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></td>
            </tr>
        </table>

    </div>
    <div class="metting-time">
        <table>

            <tr>
                <td class="timeShow">۰</td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column1">

                        </div>
                    </div>
                </td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column2">
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column3">
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column4">
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column5">
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column6">
                        </div>
                    </div>
                </td>
                <td>
                    <div class="row">
                        <div class="col-md-12" id="Column7">
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۲</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۳</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۴</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۵</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۶</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۷</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۸</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۹</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۰</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۱</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۲</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۳</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۴</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۵</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۶</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۷</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۸</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۱۹</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۲۰</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۲۱</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۲۲</td>
            </tr>
            <tr>
                <td colspan="8" class="timeShow">۲۳</td>
            </tr>
        </table>
    </div>
</div>
@section Scripts{
    <script>
        function Number2Farsi(Numbers){
            var NumbersLen          =       Numbers.length;
            var CurentDigit         =       '';
            var FinalDigits         =       '';
            var num0                =       "۰";
            var num1                =       "۱";
            var num2                =       "۲";
            var num3                =       "۳";
            var num4                =       "۴";
            var num5                =       "۵";
            var num6                =       "۶";
            var num7                =       "۷";
            var num8                =       "۸";
            var num9                =       "۹";
            if (NumbersLen <= 0 ){
                return num0;}
            else if (NumbersLen > 0 ){
                for (var i=0 ; i <= NumbersLen-1 ; i++){
                    CurentDigit  = Numbers.substring(i,i+1);
                    FinalDigits += ConvertNum(CurentDigit);
                }
            }
            function ConvertNum(Num){
                switch (Num) {
                    case '0': return num0; break;
                    case '1': return num1; break;
                    case '2': return num2; break;
                    case '3': return num3; break;
                    case '4': return num4; break;
                    case '5': return num5; break;
                    case '6': return num6; break;
                    case '7': return num7; break;
                    case '8': return num8; break;
                    case '9': return num9; break;
                    default: return Num;
                }
            }
            return FinalDigits;
        }
    </script>
    @{
        int i = 1;
        int j = 1;
        foreach (var item in Model)
        {
            int top = -30;
            top += (item.StartTimeHour * 60) + (item.StartTimeminute);
            if (j == 1)
            {
                j++;
                <script type="text/javascript">
                    var subject1 = '@item.Subject';
                    var endTime1 = '@item.EndTime';
                    var height1 = '@item.Duration';
                    var StartHour=@item.StartTimeHour;
                    var scroltop=StartHour*60;
                    $("#Column"+@i).append("<a href=\"/Meetings/Detail/"+@item.Id+"\" class=\"a-color\"><div id=\"navigation\" class=\"ColumnStyle\" style=\"top:"+@top+"px; height:"+height1+"px;\"><span>"+Number2Farsi(''+@item.StartTimeHour)+":"+Number2Farsi(''+@item.StartTimeminute)+"</span><span class=\"span-subject\">"+subject1+"</span><span class=\"span-bottom\">"+Number2Farsi(endTime1)+"</span></div></a>")
                </script>
            }
            else
            {
                <script type="text/javascript">
                    var subject = '@item.Subject';
                    var endTime = '@item.EndTime';
                    var height = '@item.Duration';


                    $("#Column"+@i).append("<a href=\"/Meetings/Detail/"+@item.Id+"\" class=\"a-color\"><div class=\"ColumnStyle\" style=\"top:"+@top+"px; height:"+height+"px;\"><span>"+Number2Farsi(''+@item.StartTimeHour)+":"+Number2Farsi(''+@item.StartTimeminute)+"</span><span class=\"span-subject\">"+subject+"</span><span class=\"span-bottom\">"+Number2Farsi(endTime)+"</span></div></a>")
                </script>
            }




            i++;
            if (i == 8)
            {
                i = 1;
            }
        }




    }


    <script>

        $(document).ready(function(){
            $('.metting-time').scrollTop(scroltop);
            //$('.metting-time').animate({ scrollTop: $('#navigation').offset().top - height1 });

        });

        function georgian_to_jalali(a,n,r){var t={g_days_in_month:[31,28,31,30,31,30,31,31,30,31,30,31],j_days_in_month:[31,31,31,31,31,31,30,30,30,30,30,29]};a=parseInt(a),n=parseInt(n),r=parseInt(r);for(var _=a-1600,s=n-1,e=r-1,o=365*_+parseInt((_+3)/4)-parseInt((_+99)/100)+parseInt((_+399)/400),p=0;s>p;++p)o+=t.g_days_in_month[p];s>1&&(_%4==0&&_%100!=0||_%400==0)&&++o,o+=e;var I=o-79,i=parseInt(I/12053);I%=12053;var y=979+33*i+4*parseInt(I/1461);I%=1461,I>=366&&(y+=parseInt((I-1)/365),I=(I-1)%365);for(var p=0;11>p&&I>=t.j_days_in_month[p];++p)I-=t.j_days_in_month[p];var d=p+1,v=I+1,h={day:v,month:d,year:y};return h}var week_start_day=0;



        function draw_days(days,item_class){




            @{
                DateTime pdate = new DateTime();
                pdate = Convert.ToDateTime(ViewBag.pdate);
                int week_day_number = (int)pdate.DayOfWeek;
            }
            var month =@pdate.Month;
            var day = @pdate.Day;
            var year =@pdate.Year;

            var MDay = day;
            var MMonth = month;
            var YYear = year;

            var persian_date = georgian_to_jalali(YYear,MMonth,MDay);



            var td = '<td><i class="fa fa-arrow-circle-right" aria-hidden="true"></i></td>';

            var i=0;

            for(i=0;i<days.length;i++){

                if(persian_date.day ==days[i].day && persian_date.month ==days[i].month && persian_date.year == days[i].year){

                    td+="<td pdate='"+days[i].year+'-'+days[i].month+'-'+days[i].day+"' class='tooltipester' title='"+Number2Farsi(""+days[i].year+"")+'-'+Number2Farsi(""+days[i].month+"")+'-'+Number2Farsi(""+days[i].day+"")+"'><span class='current_day'>"+Number2Farsi(""+days[i].day+"")+"</span></td>";

                }else{

                    td+="<td pdate='"+days[i].year+'-'+days[i].month+'-'+days[i].day+"'  class='tooltipester' title='"+Number2Farsi(""+days[i].year+"")+'-'+Number2Farsi(""+days[i].month+"")+'-'+Number2Farsi(""+days[i].day+"")+"'>"+Number2Farsi(""+days[i].day+"")+"</td>";

                }



            }
            td+='<td><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></td>';

            jQuery('.week-days-number').html(td);

        }


        function get_week_start_day(current_day,j_date){


            var georgian_to_jalali =j_date;
            var PDay = georgian_to_jalali.day;
            var PMonth = georgian_to_jalali.month;
            var PYear = georgian_to_jalali.year;

            var rooz_shanbe = PDay;

            if(current_day!=1){

                var i=0;

                for(i=1;i<current_day;i++){

                    if(rooz_shanbe - 1 == 0){

                        if(PMonth - 1 ==0 ){

                            if(isLeapYear(PYear-1)){
                                rooz_shanbe=30;
                            }else{
                                rooz_shanbe=29;
                            }
                            PMonth=12;
                            PYear--;

                        }else if(PMonth - 1 >= 7){

                            rooz_shanbe=30;
                            PMonth--;

                        }else{
                            rooz_shanbe=31;
                            PMonth--;
                        }


                    }else {
                        rooz_shanbe--;
                    }
                }
            }

            var center_obj = {day:rooz_shanbe,month:PMonth,year:PYear};



            return center_obj;

        }

        function set_days(current_day,j_date){


            var georgian_to_jalali =j_date;
            var PDay = georgian_to_jalali.day;
            var PMonth = georgian_to_jalali.month;
            var PYear = georgian_to_jalali.year;

            var rooz_shanbe = PDay;

            if(current_day!=1){

                var i=0;

                for(i=1;i<current_day;i++){

                    if(rooz_shanbe - 1 == 0){

                        if(PMonth - 1 ==0 ){

                            if(isLeapYear(PYear-1)){
                                rooz_shanbe=30;
                            }else{
                                rooz_shanbe=29;
                            }
                            PMonth=12;
                            PYear--;

                        }else if(PMonth - 1 >= 7){

                            rooz_shanbe=30;
                            PMonth--;

                        }else{
                            rooz_shanbe=31;
                            PMonth--;
                        }


                    }else {
                        rooz_shanbe--;
                    }
                }
            }


            i=0;
            var center_days = new Array();
            var center_start_days = rooz_shanbe;
            var center_PMonth = PMonth;
            var center_PYear = PYear;
            var center_PDay = PDay;


            center_days.push({day:center_start_days,month:center_PMonth,year:center_PYear});





            for(i=0;i<6;i++){

                if(center_start_days>=29){

                    if(center_start_days==29 && center_PMonth==12){


                        if(!isLeapYear(center_PYear)){
                            center_PYear++;
                            center_start_days=0;
                            center_PMonth=1;
                        }

                    }else if(center_start_days==30 && center_PMonth==12 ){


                        center_PYear++;
                        center_start_days=0;
                        center_PMonth=1;




                    }else{

                        if(center_PMonth <= 6){
                            if(center_start_days==31){
                                center_start_days=0;
                                center_PMonth++;
                            }

                        }else{

                            if(center_start_days==30){
                                center_start_days=0;
                                center_PMonth++;
                            }
                        }

                    }

                }


                center_start_days++;


                var center_obj = {day:center_start_days,month:center_PMonth,year:center_PYear};

                center_days.push(center_obj);

            }

            draw_days(center_days,".center");
            console.log(center_days);

        }


        var days = ['2','3','4','5','6','7','1'];


        var month =@pdate.Month;
        var day = @pdate.Day;
        var year =@pdate.Year;


        var MDay = day;
        var MMonth = month;
        var YYear = year;

        var d = new Date();
        var n = @week_day_number;
        var current_day = n;

        set_days(days[current_day],georgian_to_jalali(YYear,MMonth,MDay));
        week_start_day = get_week_start_day(days[current_day],georgian_to_jalali(YYear,MMonth,MDay));





        function jalali_To_Gregorian(j_y, j_m, j_d)
        {
            var JalaliDate = {
                g_days_in_month: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
                j_days_in_month: [31, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 29]
            };

            j_y = parseInt(j_y);
            j_m = parseInt(j_m);
            j_d = parseInt(j_d);
            var jy = j_y-979;
            var jm = j_m-1;
            var jd = j_d-1;

            var j_day_no = 365*jy + parseInt(jy / 33)*8 + parseInt((jy%33+3) / 4);
            for (var i=0; i < jm; ++i) j_day_no += JalaliDate.j_days_in_month[i];

            j_day_no += jd;

            var g_day_no = j_day_no+79;

            var gy = 1600 + 400 * parseInt(g_day_no / 146097); /* 146097 = 365*400 + 400/4 - 400/100 + 400/400 */
            g_day_no = g_day_no % 146097;

            var leap = true;
            if (g_day_no >= 36525) /* 36525 = 365*100 + 100/4 */
            {
                g_day_no--;
                gy += 100*parseInt(g_day_no/  36524); /* 36524 = 365*100 + 100/4 - 100/100 */
                g_day_no = g_day_no % 36524;

                if (g_day_no >= 365)
                    g_day_no++;
                else
                    leap = false;
            }

            gy += 4*parseInt(g_day_no/ 1461); /* 1461 = 365*4 + 4/4 */
            g_day_no %= 1461;

            if (g_day_no >= 366) {
                leap = false;

                g_day_no--;
                gy += parseInt(g_day_no/ 365);
                g_day_no = g_day_no % 365;
            }

            for (var i = 0; g_day_no >= JalaliDate.g_days_in_month[i] + (i == 1 && leap); i++)
                g_day_no -= JalaliDate.g_days_in_month[i] + (i == 1 && leap);
            var gm = i+1;
            var gd = g_day_no+1;

            var miladi_date = {
                day:gd,
                month:gm,
                year:gy
            };

            return miladi_date;
        }


        function isLeapYear(year) {
            var y=0;
            if (year > 0){
                y = parseInt(year) - parseInt(474);
            }
            else{
                y = parseInt(473);
            }
            return (((((y % parseInt(2820)) + parseInt(474)) + parseInt(38)) * parseInt(682)) % parseInt(2816)) < 682;
        }



        jQuery('body').on('click', '.fa-arrow-circle-right', function() {


            var i=0;
            var right_days = new Array();
            var right_start_days = week_start_day.day;

            var right_PMonth = week_start_day.month;
            var right_PYear = week_start_day.year;
            var right_PDay = week_start_day.day;




            for(i=0;i<7;i++){

                if(right_start_days - 1 == 0){

                    if(right_PMonth - 1 ==0 ){

                        if(isLeapYear(right_PYear-1)){
                            right_start_days=30;

                        }else{
                            right_start_days=29;
                        }

                        right_PMonth = 12;
                        right_PYear -= 1;

                    }else if(right_PMonth - 1 >= 7){

                        right_start_days=30;
                        right_PMonth-=1;

                    }else{
                        right_start_days=31;
                        right_PMonth-=1;
                    }


                }else {
                    right_start_days--;
                }


                var right_obj = {day:right_start_days,month:right_PMonth,year:right_PYear};

                right_days.push(right_obj);



            }

            right_days.reverse();
            week_start_day = right_days[0];
            draw_days(right_days,"");
            $('.tooltipester').tooltipster({position:'bottom'});

        });

        jQuery('body').on('click', '.fa-arrow-circle-left', function() {


            var i=0;
            var left_days = new Array();

            var left_start_days = week_start_day.day;

            var left_PMonth = week_start_day.month;
            var left_PYear = week_start_day.year;
            var left_PDay = week_start_day.day;





            for(i=0;i<13;i++){

                if(left_start_days>=29){


                    if(left_start_days==29 && left_PMonth==12){


                        if(!isLeapYear(left_PYear)){

                            left_PYear++;
                            left_start_days=0;
                            left_PMonth=1;
                        }

                    }else if(left_start_days==30 && left_PMonth==12 ){



                        left_PYear++;
                        left_start_days=0;
                        left_PMonth=1;


                    }else{

                        if(left_PMonth <= 6){
                            if(left_start_days==31){
                                left_start_days=0;
                                left_PMonth++;
                            }

                        }else{

                            if(left_start_days==30){
                                left_start_days=0;
                                left_PMonth++;
                            }
                        }

                    }

                }


                left_start_days++;


                if(i>5){


                    var left_obj = {day:left_start_days,month:left_PMonth,year:left_PYear};
                    left_days.push(left_obj);

                }


            }

            // left_days.reverse();
            week_start_day = left_days[0];
            draw_days(left_days,"");
            $('.tooltipester').tooltipster({position:'bottom'});


        });

    </script>
    <script src="~/Scripts/jquery.tooltipster.js"></script>
    <script>
        $('.tooltipester').tooltipster({position:'bottom'});
        $(".week-days-number ").on("click", "td.tooltipester", function(){
            var date=$(this).attr("pdate");

            window.location.href = '/Meetings/Index?pdate='+date;
        });
    </script>

}






